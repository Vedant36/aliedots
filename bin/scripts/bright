#!/usr/bin/env sh
## Dependencies: need to able to edit brightness
##  ^Refer to: /home/vn36/.local/lib/root/etc/udev/rules.d/backlight.rules
## Update 0.2 on 2022-02-14
##   - shellchecked
##   - print brightness
##   - switched from bc to internal sh calculations
##   - uppercased constants

help() {
	cat<<EOF
Usage:
  $(basename "$0") [-i] value
  sets brightness to value in percentage
  using -i increments brightness(accepts negative values)
  Current brightness: $((BRIGHTNESS / MAX_BRIGHTNESS))
EOF
	[ "$1" = "-e" ] && exit
	exit 1
}

[ "$1" ] || help

BACKLIGHT="/sys/class/backlight/amdgpu_bl0"
MAX_BRIGHTNESS=$(cat $BACKLIGHT/max_brightness)
BRIGHTNESS=$(cat $BACKLIGHT/brightness)

case $1 in
	-h) help -e ;;
	-i) new_brightness=$(("$2" * MAX_BRIGHTNESS / 100 + BRIGHTNESS)) ;;
	-p) echo "$BRIGHTNESS"; exit ;;
	*) new_brightness=$((MAX_BRIGHTNESS * "$1" / 100)) ;;
esac

[ "$new_brightness" -lt 0 ] && new_brightness=0
[ "$new_brightness" -gt "$MAX_BRIGHTNESS" ] && new_brightness=$MAX_BRIGHTNESS
echo "$new_brightness" > $BACKLIGHT/brightness

